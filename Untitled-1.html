<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Authenticated API Fetch with Alpine.js</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.js" defer></script>
</head>
<body x-data="paginationData()">
  <div class="container mt-4">
    <div id="data-container" x-html="dataHtml"></div>
    <nav aria-label="Page navigation">
      <ul class="pagination">
        <template x-for="page in totalPages" :key="page">
          <li class="page-item" :class="{ 'active': page === currentPage }">
            <a class="page-link" @click="loadData(page)" x-text="page"></a>
          </li>
        </template>
      </ul>
    </nav>
  </div>

  <script>
    function paginationData() {
      return {
        currentPage: 1,
        pageSize: 10, // Adjust according to your API
        totalPages: 1,
        dataHtml: '',
        authToken: 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOlwvXC9wYXJ0bmVyLWFwaS5jYXJ0cnVzdC5zYVwvYXBpXC92MlwvdmVyaWZ5LW90cCIsImlhdCI6MTcwMzUzNjUxMCwibmJmIjoxNzAzNTM2NTEwLCJqdGkiOiJNdThENHBTTFAzQ096cTN6Iiwic3ViIjo4OTQsInBydiI6IjIzYmQ1Yzg5NDlmNjAwYWRiMzllNzAxYzQwMDg3MmRiN2E1OTc2ZjcifQ.OYdaYH6hiudXVaGY2JUSHI_DcAGJ8KNw5V7tz4r-sTQ', // Replace with your actual auth token

        async fetchData(page) {
          try {
            const response = await fetch(`https://partner-api.cartrust.sa/api/v2/pg/evaluations?page=${page}`, {
              headers: {
                Authorization: `Bearer ${this.authToken}`,
                // Add other headers as needed
              },
            });

            const data = await response.json();
            this.totalPages = data.response.lastPage;
            return data.response.data;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },

        async loadData(page) {
          const newData = await this.fetchData(page);

          if (newData && newData.length > 0) {
            this.dataHtml = newData.map(item => `<div>${item.make}</div>`).join('');
            this.currentPage = page;
            
          } else {
            console.log('No data available.');
          }
        },

        initialize() {
          // Fetch data for the initial page
          this.loadData(this.currentPage);

         
        },
      };
    }

    document.addEventListener('alpine:init', () => {
      const paginationApp = Alpine.data('paginationData');
      paginationApp.initialize();
    });
  </script>
</body>
</html>
