<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Number Pagination with Alpine.js</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@2.8.2/dist/alpine.js" defer></script>
</head>
<body x-data="paginationData()">
  <div class="container mt-4">
    <div id="data-container" x-html="dataHtml"></div>
    <nav aria-label="Page navigation">
      <ul class="pagination">
        <li class="page-item">
          <a class="page-link" @click="loadData(currentPage - 1)" :disabled="currentPage === 1">&laquo; Previous</a>
        </li>
        <template x-for="group in pageGroups" :key="group">
          <template x-if="group === '...'">
            <li class="page-item disabled"><span class="page-link">...</span></li>
          </template>
          <template x-if="group !== '...'">
            <li class="page-item" :class="{ 'active': group === currentPage }">
              <a class="page-link" @click="loadData(group)" x-text="group"></a>
            </li>
          </template>
        </template>
        <li class="page-item">
          <a class="page-link" @click="loadData(currentPage + 1)" :disabled="currentPage === totalPages">Next &raquo;</a>
        </li>
      </ul>
    </nav>
  </div>

  <script>
    function paginationData() {
      return {
        currentPage: 1,
        pageSize: 10, // Adjust according to your API
        totalPages: 1,
        dataHtml: '',
        pageGroups: [],

        async fetchData(page) {
          try {
            const response = await fetch(`https://api.example.com/data?page=${page}&size=${this.pageSize}`);
            const data = await response.json();
            return data;
          } catch (error) {
            console.error('Error fetching data:', error);
          }
        },

        async loadPageGroups() {
          const groups = [];
          let start = Math.max(1, this.currentPage - 2);
          let end = Math.min(this.totalPages, start + 4);

          if (this.totalPages > 5 && end === this.totalPages) {
            start = Math.max(1, end - 4);
          }

          if (start > 1) {
            groups.push('...');
          }

          for (let i = start; i <= end; i++) {
            groups.push(i);
          }

          if (end < this.totalPages) {
            groups.push('...');
          }

          this.pageGroups = groups;
        },

        async loadData(page) {
          const newData = await this.fetchData(page);

          if (newData && newData.length > 0) {
            this.dataHtml = newData.map(item => `<div>${item.name}</div>`).join('');
            this.currentPage = page;
            this.loadPageGroups();
          } else {
            alert('No data available.');
          }
        },

        initialize() {
          // Fetch data for the initial page
          this.loadData(this.currentPage);

          // Fetch total items count from the API to calculate total pages
          fetch('https://api.example.com/total-items')
            .then(response => response.json())
            .then(totalItems => {
              this.totalPages = Math.ceil(totalItems / this.pageSize);
              this.loadPageGroups();
            })
            .catch(error => console.error('Error fetching total items count:', error));
        },
      };
    }

    document.addEventListener('alpine:init', () => {
      const paginationApp = Alpine.data('paginationData');
      paginationApp.initialize();
    });
  </script>
</body>
</html>
